/* Pack component container */
.pack-container {
  display: flex;
  flex-direction: column;
  align-items: center;
}

/* Pack controls */
.pack-controls {
  display: flex;
  gap: 8px;
  align-items: center;
}

/* Pack results container */
.pack-results {
  margin-top: 20px;
}

/* Individual card result */
.pack-card-result {
  margin-bottom: 20px;
}

/* Pack button */
.pack-container .card-button {
  margin-top: 20px;
}

.pack-card-image {
  width: 300px;
  height: auto;
  display: block;
}

.pack-card-info {
  text-align: center;
}

/* Holographic effect CSS variables */
/* holographic effect from Simon Goellner - https://poke-holo.simey.me/ */

/* Base holographic effect for rare cards */
.card-holo,
.card-holo::after {
  --space: 5%;
  --angle: 133deg;
  --imgsize: 50%;
  
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  border-radius: 4.55% / 3.5%;

  background-image: url("https://res.cloudinary.com/simey/image/upload/Dev/PokemonCards/illusion.webp"),
    repeating-linear-gradient(
      0deg,
      rgb(255, 119, 115) calc(var(--space) * 1),
      rgba(255, 237, 95, 1) calc(var(--space) * 2),
      rgba(168, 255, 95, 1) calc(var(--space) * 3),
      rgba(131, 255, 247, 1) calc(var(--space) * 4),
      rgba(120, 148, 255, 1) calc(var(--space) * 5),
      rgb(216, 117, 255) calc(var(--space) * 6),
      rgb(255, 119, 115) calc(var(--space) * 7)
    ),
    repeating-linear-gradient(
      var(--angle),
      #0e152e 0%,
      hsl(180, 10%, 60%) 3.8%,
      hsl(180, 29%, 66%) 4.5%,
      hsl(180, 10%, 60%) 5.2%,
      #0e152e 10%,
      #0e152e 12%
    ),
    radial-gradient(
      farthest-corner circle at var(--mx) var(--my),
      rgba(0, 0, 0, 0.1) 12%,
      rgba(0, 0, 0, 0.15) 20%,
      rgba(0, 0, 0, 0.25) 120%
    );

  background-blend-mode: difference, hue, hard-light;
  background-size: var(--imgsize), 200% 700%, 300%, 200%;
  background-position: center, 0% var(--posy), var(--posx) var(--posy),
    var(--posx) var(--posy);

  filter: brightness(0.75) contrast(2.5) saturate(0.75);
}

.card-holo::after {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  border-radius: 4.55% / 3.5%;

  background-size: var(--imgsize), 200% 400%, 195%, 200%;
  background-position: center, 0% var(--posy),
    calc(var(--posx) * -1) calc(var(--posy) * -1), var(--posx) var(--posy);

  filter: brightness(1.2) contrast(1) saturate(1.75);
  mix-blend-mode: exclusion;
}

/* Ensure holo/glare overlays appear above the image in the pack view */
.pack-card-result .card-glare,
.pack-card-result .card-holo,
.pack-card-result .card-holo::after {
  z-index: 9999;
  pointer-events: none;
}

/* Clipped holo effect for image only (diamond & pearl rare cards) */
.card-holo-clipped {
  clip-path: inset(10% 8.5% 50% 8.5%);
}

/* Pack opening animation container */
.pack-opening-container {
  margin-top: 20px;
  margin-bottom: 40px;
  display: flex;
  justify-content: center;
  align-items: center;
}

.pack-interaction-area {
  position: relative;
  width: 460px; /* 300px pack + 80px padding on each side */
  height: 420px; /* 420px pack + 40px padding top/bottom */
  cursor: crosshair;
  display: flex;
  justify-content: center;
  align-items: center;
}

.pack-graphic {
  position: relative;
  width: 300px;
  height: 420px;
  display: flex;
  justify-content: center;
  align-items: center;
}

.pack-half {
  position: absolute;
  left: 0;
  width: 100%;
  transition: transform 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55), opacity 0.6s ease;
}

.pack-top {
  top: 0;
  height: 21px; /* 5% of 420px */
  background: linear-gradient(135deg, #ffd700 0%, #1e90ff 100%);
  border-radius: 12px 12px 0 0;
}

.pack-bottom {
  top: 21px; /* starts right after the top 5% */
  height: 399px; /* 95% of 420px */
  background: linear-gradient(135deg, #1e90ff 0%, #ffd700 100%);
  border-radius: 0 0 12px 12px;
}

.cut-line {
  position: absolute;
  top: 21px; /* 5% mark where cut happens */
  left: 0;
  height: 3px;
  background: linear-gradient(90deg, 
    rgba(255, 255, 255, 0.9) 0%, 
    rgba(255, 215, 0, 1) 30%,
    rgba(255, 255, 255, 1) 100%);
  box-shadow: 
    0 0 15px rgba(255, 215, 0, 1),
    0 0 30px rgba(255, 215, 0, 0.8),
    0 0 45px rgba(255, 215, 0, 0.5),
    0 2px 8px rgba(255, 255, 255, 0.6);
  transition: width 0.05s linear;
  pointer-events: none;
  z-index: 10;
  border-radius: 2px;
}

.pack-instruction {
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  color: #000000;
  font-size: 14px;
  font-weight: 500;
  pointer-events: none;
  animation: pulse 1.5s ease-in-out infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 0.7; }
  50% { opacity: 1; }
}

/* Pack opening animation */
.pack-graphic.opening .pack-top {
  transform: translateY(-80px) rotate(-8deg);
  opacity: 0;
}

.pack-graphic.opening .pack-bottom {
  transform: translateY(60px) rotate(3deg);
  opacity: 0;
}

.pack-graphic.opening .cut-line {
  opacity: 0;
}

/* Pack opening animation and stacked layout */
.pack-results {
  /* pull the stack up slightly but avoid covering the button */
  margin-top: -28px;
  position: relative;
  width: 340px;
  height: 440px;
}

/* Hide cards during pack opening animation but keep them in DOM for effects to initialize */
.pack-results.hidden {
  opacity: 0;
  pointer-events: none;
  position: absolute;
  left: -9999px;
}

/* Clip sliding cards so off-screen transforms don't create page scrollbars */
.pack-clip {
  width: 100%;
  height: 100%;
  overflow-x: hidden;
  overflow-y: visible;
}
.pack-clip.no-clip { overflow-x: visible; display: contents; }

.pack-results .pack-card-result {
  position: absolute;
  left: 50%;
  /* place the cards slightly lower so they don't overlap the button */
  top: 12%;
  transform-origin: 50% 100%;
  /* start further off-screen to keep cards more hidden; var --i used for stagger */
  transform: translateX(150%) translateY(0);
  transition: transform 500ms cubic-bezier(.22,.9,.28,1), opacity 260ms ease;
  transition-delay: calc(var(--i) * 40ms);
  z-index: calc(var(--total) - var(--i));
  width: 300px;
  pointer-events: none;
}

.pack-results.pack-opened .pack-card-result {
  transform: translateX(-50%) translateY(0);
  pointer-events: none;
}

.pack-card-result.clickable { 
  cursor: pointer; 
  pointer-events: auto; 
  z-index: calc(var(--total) + 100); 
}

.pack-card-result .card-3d-container { 
  overflow: visible; 
}

.pack-card-result.clickable .pack-card-image {
  transition: transform 140ms cubic-bezier(.2,.9,.2,1), box-shadow 140ms ease;
  transform-origin: 50% 50%;
  position: relative;
  z-index: calc(var(--total) + 10);
  will-change: transform;
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
  transform: translateZ(0);
}
.pack-card-result.clickable:hover .pack-card-image {
  transform: scale3d(1.08,1.08,1);
  box-shadow: 0 18px 40px rgba(0,0,0,0.55);
  z-index: calc(var(--total) + 200);
}

.pack-card-result.clickable .card-grid-cell { 
  pointer-events: auto; 
}

.pack-card-result.removed {
  animation: slideOut 700ms cubic-bezier(.2,.9,.2,1) forwards;
  opacity: 0;
  pointer-events: none;
  z-index: 0;
}

@keyframes slideOut {
  0% {
    transform: translateX(-50%) translateY(0) rotate(0deg) scale(1);
    opacity: 1;
  }
  100% {
    transform: translateX(130%) translateY(0) rotate(10deg) scale(0.92);
    opacity: 0;
  }
}

/* Final reveal: show all cards in a grid */
.pack-results.pack-final {
  position: static;
  width: 100%;
  height: auto;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  grid-auto-flow: row;
  gap: 12px;
  margin-top: 20px;
  justify-items: center;
}

.pack-results.pack-opened { animation: peek 600ms ease 1 both; }
@keyframes peek {
  0% { transform: translateY(0); }
  20% { transform: translateY(-4px); }
  40% { transform: translateY(0); }
  60% { transform: translateY(-2px); }
  100% { transform: translateY(0); }
}

.pack-results.pack-final .pack-card-result {
  position: relative;
  left: auto;
  top: auto;
  transform: none !important;
  transition: transform 600ms ease, opacity 300ms ease;
  margin: 0 auto;
  width: 100%;
}

.pack-results.pack-final .pack-card-image { width: 100%; max-width: 360px; }

/* Responsive: make stack smaller on small screens */
@media (max-width: 640px) {
  .pack-results { width: 95%; }
  .pack-card-image { width: 220px; }
}
